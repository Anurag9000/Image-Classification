2026-01-20 13:40:52,931 - INFO - Loading config from: configs/garbage_edge.yaml
2026-01-20 13:40:52,940 - INFO - ===> Starting ArcFace Training Phase
2026-01-20 13:40:52,940 - INFO - Using CombinedFilesDataset with roots: ['./data']
2026-01-20 13:40:52,947 - INFO - Creating loader from JSON: ./data/Dataset_Final_Aug/dataset_aug_metadata.json
2026-01-20 13:40:54,548 - INFO - JsonDataset loaded 617837 images. Classes: {'organic': 0, 'other': 1, 'paper': 2, 'plastic': 3}
2026-01-20 13:40:54,550 - INFO - Splitting dataset: Train=494271, Val=61783, Test=61783
2026-01-20 13:40:56,248 - INFO - JsonDataset loaded 617837 images. Classes: {'organic': 0, 'other': 1, 'paper': 2, 'plastic': 3}
2026-01-20 13:40:57,933 - INFO - JsonDataset loaded 617837 images. Classes: {'organic': 0, 'other': 1, 'paper': 2, 'plastic': 3}
2026-01-20 13:40:59,749 - INFO - JsonDataset loaded 617837 images. Classes: {'organic': 0, 'other': 1, 'paper': 2, 'plastic': 3}
2026-01-20 13:40:59,750 - INFO - Created independent Subsets: Train(494271), Val(61783), Test(61783)
2026-01-20 13:41:00,569 - INFO - WeightedRandomSampler enabled. Class counts: [ 79224 225438 118240  71369]
2026-01-20 13:41:01,564 - INFO - Loading pretrained weights from Hugging Face hub (timm/resnet18.a1_in1k)
2026-01-20 13:41:02,002 - INFO - [timm/resnet18.a1_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2026-01-20 13:41:02,184 - INFO - HybridBackbone Dimensions Detected -> CNN: 512, ViT: 0
2026-01-20 13:41:02,186 - INFO - CBAM initialized with channels: 512
2026-01-20 13:41:02,370 - INFO - Loading SupCon weights from ./snapshots/supcon_final_best.pth...
2026-01-20 13:41:02,536 - INFO - SupCon weights loaded successfully.
2026-01-20 13:41:02,540 - INFO - Initialized AdaFace Loss (Adaptive Margin for low-quality images).
2026-01-20 13:45:55,631 - ERROR - Phase arcface failed: Caught RuntimeError in DataLoader worker process 1.
Original Traceback (most recent call last):
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\fetch.py", line 55, in fetch
    return self.collate_fn(data)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 398, in default_collate
    return collate(batch, collate_fn_map=default_collate_fn_map)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 211, in collate
    return [
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 212, in <listcomp>
    collate(samples, collate_fn_map=collate_fn_map)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 155, in collate
    return collate_fn_map[elem_type](batch, collate_fn_map=collate_fn_map)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 270, in collate_tensor_fn
    storage = elem._typed_storage()._new_shared(numel, device=elem.device)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\storage.py", line 1198, in _new_shared
    untyped_storage = torch.UntypedStorage._new_shared(
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\storage.py", line 413, in _new_shared
    return cls._new_using_filename_cpu(size)
RuntimeError: Couldn't open shared file mapping: <torch_262480_1726441913_4>, error code: <1455>

2026-01-20 13:45:55,656 - ERROR - Traceback (most recent call last):
  File "D:\Done,Toreview\Image Classification\pipeline\run_pipeline.py", line 448, in run_pipeline
    runner()
  File "D:\Done,Toreview\Image Classification\pipeline\run_pipeline.py", line 436, in <lambda>
    "arcface": lambda: run_arcface_phase(cfg), # Pass full cfg to arcface runner to access 'dataset'
  File "D:\Done,Toreview\Image Classification\pipeline\run_pipeline.py", line 145, in run_arcface_phase
    trainer.train()
  File "D:\Done,Toreview\Image Classification\pipeline\train_arcface.py", line 299, in train
    v_loss, v_acc, v_f1 = self._validate()
  File "D:\Done,Toreview\Image Classification\pipeline\train_arcface.py", line 203, in _validate
    for i, (images, labels) in enumerate(self.val_loader):
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\dataloader.py", line 708, in __next__
    data = self._next_data()
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\dataloader.py", line 1480, in _next_data
    return self._process_data(data)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\dataloader.py", line 1505, in _process_data
    data.reraise()
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\_utils.py", line 733, in reraise
    raise exception
RuntimeError: Caught RuntimeError in DataLoader worker process 1.
Original Traceback (most recent call last):
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\worker.py", line 349, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\fetch.py", line 55, in fetch
    return self.collate_fn(data)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 398, in default_collate
    return collate(batch, collate_fn_map=default_collate_fn_map)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 211, in collate
    return [
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 212, in <listcomp>
    collate(samples, collate_fn_map=collate_fn_map)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 155, in collate
    return collate_fn_map[elem_type](batch, collate_fn_map=collate_fn_map)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\utils\data\_utils\collate.py", line 270, in collate_tensor_fn
    storage = elem._typed_storage()._new_shared(numel, device=elem.device)
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\storage.py", line 1198, in _new_shared
    untyped_storage = torch.UntypedStorage._new_shared(
  File "C:\Users\DELL\AppData\Local\Programs\Python\Python310\lib\site-packages\torch\storage.py", line 413, in _new_shared
    return cls._new_using_filename_cpu(size)
RuntimeError: Couldn't open shared file mapping: <torch_262480_1726441913_4>, error code: <1455>


